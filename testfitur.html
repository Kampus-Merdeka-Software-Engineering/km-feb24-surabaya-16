<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Total Profit and Sales by Category</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="script.js" defer></script>
    <style>
        #chart-container {
            position: relative;
            height: 70vh;
            width: 90vw;
        }
    </style>
</head>
<body>
    <div id="chart-container">
        <canvas id="profitChart"></canvas>
    </div>
</body>
</html>

<script>
    const DataUrl = 'http://localhost:3000/data';

// Fungsi untuk memuat data dari file JSON
async function fetchData(url) {
    const response = await fetch(url);
    if (!response.ok) {
        throw new Error('Network response was not ok');
    }
    const data = await response.json();
    return data;
}

// Fungsi untuk memformat data menjadi total sales dan profit per kategori
function formatDataForProfitAndSales(data) {
    const categoryData = {};

    data.forEach(order => {
        const category = order.Category;
        const sales = parseFloat(order.Sales.replace(/[^0-9.-]+/g, ""));
        const profit = parseFloat(order.Profit.replace(/[^0-9.-]+/g, ""));

        if (!categoryData[category]) {
            categoryData[category] = { sales: 0, profit: 0 };
        }

        categoryData[category].sales += sales;
        categoryData[category].profit += profit;
    });

    return categoryData;
}

// Fungsi untuk membuat chart
async function createChart() {
    const data = await fetchData(DataUrl);
    const formattedData = formatDataForProfitAndSales(data);

    const labels = Object.keys(formattedData);
    const salesData = Object.values(formattedData).map(entry => entry.sales);
    const profitData = Object.values(formattedData).map(entry => entry.profit);

    const ctx = document.getElementById('profitChart').getContext('2d');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [
                {
                    label: 'Sales',
                    data: salesData,
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1
                },
                {
                    label: 'Profit',
                    data: profitData,
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 1
                }
            ]
        },
        options: {
            indexAxis: 'y', // Mengatur chart menjadi horizontal
            responsive: true,
            scales: {
                x: {
                    beginAtZero: true
                }
            }
        }
    });
}

// Membuat chart setelah halaman selesai dimuat
window.addEventListener('load', createChart);

</script>