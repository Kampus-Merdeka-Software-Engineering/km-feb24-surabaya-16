<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sales and Profit Line Chart</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="script.js" defer></script>
    <style>
        #chart-container {
            position: relative;
            height: 70vh;
            width: 90vw;
        }
    </style>
</head>
<body>
    <div id="chart-container">
        <canvas id="LineChartSalesProfit"></canvas>
    </div>
</body>
</html>


<script>
    const preprocessData = (data) => {
       const result = {};

       data.forEach(order => {
           const date = new Date(order["Order Date"]);
           const year = date.getFullYear();
           const month = date.toLocaleString('default', { month: 'long' });

           if (!result[year]) {
               result[year] = {};
           }

           if (!result[year][month]) {
               result[year][month] = { sales: 0, profit: 0 };
           }

           result[year][month].sales += parseFloat(order.Sales.replace(/[^0-9.-]+/g, ""));
           result[year][month].profit += parseFloat(order.Profit.replace(/[^0-9.-]+/g, ""));
       });

       const sortedData = [];

       Object.keys(result).sort().forEach(year => {
           Object.keys(result[year]).sort((a, b) => new Date(`1 ${a} ${year}`) - new Date(`1 ${b} ${year}`)).forEach(month => {
               sortedData.push({
                   monthYear: `${month} ${year}`,
                   sales: result[year][month].sales,
                   profit: result[year][month].profit
               });
           });
       });

       return sortedData;
   };

   // Konfigurasi line chart
   const createLineChart = (processedData) => {
       const labelsMonthYear = processedData.map(data => data.monthYear);
       const sales = processedData.map(data => data.sales);
       const profits = processedData.map(data => data.profit);

       const ctxLSP = document.getElementById('LineChartSalesProfit').getContext('2d');
       new Chart(ctxLSP, {
           type: 'line',
           data: {
               labels: labelsMonthYear,
               datasets: [
                   {
                       label: 'Sales',
                       data: sales,
                       borderColor: 'rgba(75, 192, 192, 1)',
                       borderWidth: 2,
                       fill: false,
                       tension: 0.2,
                   },
                   {
                       label: 'Profit',
                       data: profits,
                       borderColor: 'rgba(153, 102, 255, 1)',
                       borderWidth: 2,
                       fill: false,
                       tension: 0.2,
                   }
               ]
           },
           options: {
               responsive: true, 
               maintainAspectRatio: false, 
               scales: {
                   x: {
                       display: true,
                       title: {
                           display: true,
                           text: 'Month/Year'
                       }
                   },
                   y: {
                       display: true,
                       title: {
                           display: true,
                           text: 'Amount ($)'
                       }
                   }
               }
           }
       });
   };

   // Fetching data dari json
   fetch(DataUrl)
       .then(response => response.json())
       .then(data => {
           const processedDataLineChart = preprocessData(data);
           createLineChart(processedDataLineChart);
       })
       .catch(error => console.error('Error fetching data:', error));

    

</script>