<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Choropleth Map Chart</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-geo"></script>
</head>
<body>
  <canvas id="canvas" width="800" height="600"></canvas>

  <script>
    const DataUrl = 'http://localhost:3000/data';

    // Ambil data dari URL
    function fetchData(url) {
      return fetch(url)
        .then(response => {
          if (!response.ok) {
            throw new Error('Network response was not ok');
          }
          return response.json();
        })
        .catch(error => {
          console.error('There was a problem with the fetch operation:', error);
        });
    }

    // Ambil data peta dari URL dan buat choropleth map
    fetchData('https://unpkg.com/us-atlas/states-10m.json')
      .then(us => {
        const nation = ChartGeo.topojson.feature(us, us.objects.nation).features[0];
        const states = ChartGeo.topojson.feature(us, us.objects.states).features;

        // Setelah mendapatkan data peta, ambil juga data penjualan
        fetchData(DataUrl)
          .then(salesData => {
            const chart = new Chart(document.getElementById("canvas").getContext("2d"), {
              type: 'choropleth',
              data: {
                labels: states.map((d) => d.properties.name),
                datasets: [{
                  label: 'States',
                  outline: nation,
                  data: states.map((d) => ({
                    feature: d,
                    value: salesData.find(s => s.State === d.properties.name).Sales // Ambil nilai penjualan sesuai dengan nama negara bagian
                  })),
                }]
              },
              options: {
                plugins: {
                  legend: {
                    display: false
                  },
                },
                scales: {
                  projection: {
                    axis: 'x',
                    projection: 'albersUsa'
                  },
                  color: {
                    axis: 'x',
                    quantize: 5,
                    legend: {
                      position: 'bottom-right',
                      align: 'bottom'
                    },
                  }
                },
              }
            });
          })
          .catch(error => {
            console.error('There was a problem fetching sales data:', error);
          });
      })
      .catch(error => {
        console.error('There was a problem fetching map data:', error);
      });
  </script>
</body>
</html>
